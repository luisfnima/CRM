generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model companies {
  id                  Int                   @id @default(autoincrement())
  name                String                @db.VarChar(200)
  domain              String                @unique @db.VarChar(150)
  primary_color       String?               @default("#3b82f6") @db.VarChar(7)
  secondary_color     String?               @default("#e2e2e2") @db.VarChar(7)
  logo_url            String?               @db.VarChar(500)
  active              Boolean?              @default(true)
  created_at          DateTime?             @default(now()) @db.Timestamp(6)
  updated_at          DateTime?             @default(now()) @updatedAt @db.Timestamp(6)
  announcements       announcements[]
  branches            branches[]
  disconnection_types disconnection_types[]
  popups              popups[]
  roles               roles[]
  schedules           schedules[]
  users               users[]

  @@map("companies")
}

model branches {
  id         Int       @id @default(autoincrement())
  company_id Int
  name       String    @db.VarChar(100)
  address    String?   @db.VarChar(300)
  active     Boolean?  @default(true)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  company    companies @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users[]

  @@index([company_id], map: "idx_branches_company")
  @@map("branches")
}

model schedules {
  id             Int              @id @default(autoincrement())
  company_id     Int
  name           String           @db.VarChar(100)
  start_time     DateTime         @db.Time(6)
  end_time       DateTime         @db.Time(6)
  week_days      Json?            @default("[\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\"]")
  is_24_hours    Boolean?         @default(false)
  active         Boolean?         @default(true)
  created_at     DateTime?        @default(now()) @db.Timestamp(6)
  role_schedules role_schedules[]
  company        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users          users[]

  @@index([company_id], map: "idx_schedules_company")
  @@map("schedules")
}

model roles {
  id             Int              @id @default(autoincrement())
  company_id     Int
  name           String           @db.VarChar(100)
  description    String?          @db.VarChar(300)
  permissions    Json?            @default("{}")
  active         Boolean?         @default(true)
  created_at     DateTime?        @default(now()) @db.Timestamp(6)
  role_type      String?          @db.VarChar(20)
  role_schedules role_schedules[]
  company        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users          users[]

  @@unique([company_id, name])
  @@index([company_id], map: "idx_roles_company")
  @@map("roles")
}

model role_schedules {
  id          Int       @id @default(autoincrement())
  role_id     Int
  schedule_id Int
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  role        roles     @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  schedule    schedules @relation(fields: [schedule_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([role_id, schedule_id])
  @@index([role_id], map: "idx_role_schedules_role")
  @@index([schedule_id], map: "idx_role_schedules_schedule")
  @@map("role_schedules")
}

model users {
  id                                              Int                   @id @default(autoincrement())
  company_id                                      Int
  name                                            String                @db.VarChar(150)
  email                                           String                @db.VarChar(200)
  role_id                                         Int?
  branch_id                                       Int?
  schedule_id                                     Int?
  photo_url                                       String?               @db.VarChar(500)
  phone                                           String?               @db.VarChar(20)
  status                                          String?               @default("active") @db.VarChar(20)
  last_access                                     DateTime?             @db.Timestamp(6)
  created_at                                      DateTime?             @default(now()) @db.Timestamp(6)
  updated_at                                      DateTime?             @default(now()) @updatedAt @db.Timestamp(6)
  password                                        String?               @db.VarChar(255)
  announcements_created                           announcements[]
  attendance                                      attendance[]
  navigation                                      navigation[]
  password_access_log                             password_access_log[]
  password_vault_password_vault_created_byTousers password_vault[]      @relation("password_vault_created_byTousers")
  password_vault_password_vault_user_idTousers    password_vault?       @relation("password_vault_user_idTousers")
  popup_views                                     popup_views[]
  popups_created                                  popups[]
  sessions                                        sessions[]
  branch                                          branches?             @relation(fields: [branch_id], references: [id], onUpdate: NoAction)
  company                                         companies             @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  role                                            roles?                @relation(fields: [role_id], references: [id], onUpdate: NoAction)
  schedule                                        schedules?            @relation(fields: [schedule_id], references: [id], onUpdate: NoAction)
  vault_sessions                                  vault_sessions[]

  @@unique([company_id, email])
  @@index([branch_id], map: "idx_users_branch")
  @@index([company_id], map: "idx_users_company")
  @@index([company_id, email], map: "idx_users_email")
  @@index([role_id], map: "idx_users_role")
  @@index([status], map: "idx_users_status")
  @@map("users")
}

model sessions {
  id         Int          @id @default(autoincrement())
  user_id    Int
  ip_address String?      @db.VarChar(45)
  user_agent String?
  started_at DateTime?    @default(now()) @db.Timestamp(6)
  ended_at   DateTime?    @db.Timestamp(6)
  is_active  Boolean?     @default(true)
  created_at DateTime?    @default(now()) @db.Timestamp(6)
  navigation navigation[]
  user       users        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([is_active], map: "idx_sessions_active")
  @@index([user_id], map: "idx_sessions_user")
  @@map("sessions")
}

model navigation {
  id         Int       @id @default(autoincrement())
  session_id Int
  user_id    Int
  page_url   String    @db.VarChar(500)
  page_title String?   @db.VarChar(200)
  action     String?   @db.VarChar(50)
  visited_at DateTime? @default(now()) @db.Timestamp(6)
  session    sessions  @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([session_id], map: "idx_navigation_session")
  @@index([user_id], map: "idx_navigation_user")
  @@map("navigation")
}

model attendance {
  id                    Int                  @id @default(autoincrement())
  user_id               Int
  date                  DateTime             @db.Date
  check_in              DateTime             @db.Timestamp(6)
  check_out             DateTime?            @db.Timestamp(6)
  disconnection_type_id Int?
  break_time            Int?                 @default(0)
  total_hours           Decimal?             @db.Decimal(5, 2)
  status                String?              @default("in_progress") @db.VarChar(20)
  notes                 String?
  created_at            DateTime?            @default(now()) @db.Timestamp(6)
  disconnection_types   disconnection_types? @relation(fields: [disconnection_type_id], references: [id], onUpdate: NoAction)
  user                  users                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  attendance_breaks     attendance_breaks[]

  @@index([date], map: "idx_attendance_date")
  @@index([user_id], map: "idx_attendance_user")
  @@map("attendance")
}

model attendance_breaks {
  id                    Int                 @id @default(autoincrement())
  attendance_id         Int
  disconnection_type_id Int
  started_at            DateTime            @db.Timestamp(6)
  ended_at              DateTime?           @db.Timestamp(6)
  duration              Int?
  notes                 String?
  created_at            DateTime?           @default(now()) @db.Timestamp(6)
  attendance            attendance          @relation(fields: [attendance_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  disconnection_types   disconnection_types @relation(fields: [disconnection_type_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([attendance_id], map: "idx_attendance_breaks_attendance")
  @@map("attendance_breaks")
}

model announcements {
  id         Int       @id @default(autoincrement())
  company_id Int
  title      String    @db.VarChar(200)
  content    String
  image_url  String?   @db.VarChar(500)
  priority   String?   @default("normal") @db.VarChar(20)
  start_date DateTime  @db.Timestamp(6)
  end_date   DateTime? @db.Timestamp(6)
  active     Boolean?  @default(true)
  created_by Int?
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
  company    companies @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  creator    users?    @relation(fields: [created_by], references: [id], onUpdate: NoAction)

  @@index([active], map: "idx_announcements_active")
  @@index([company_id], map: "idx_announcements_company")
  @@map("announcements")
}

model popups {
  id          Int           @id @default(autoincrement())
  company_id  Int
  title       String        @db.VarChar(200)
  message     String
  image_url   String?       @db.VarChar(500)
  button_text String?       @default("Entendido") @db.VarChar(50)
  start_date  DateTime      @db.Timestamp(6)
  end_date    DateTime?     @db.Timestamp(6)
  active      Boolean?      @default(true)
  show_once   Boolean?      @default(false)
  created_by  Int?
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  popup_views popup_views[]
  company     companies     @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  creator     users?        @relation(fields: [created_by], references: [id], onUpdate: NoAction)

  @@index([active], map: "idx_popups_active")
  @@index([company_id], map: "idx_popups_company")
  @@map("popups")
}

model popup_views {
  id        Int       @id @default(autoincrement())
  popup_id  Int
  user_id   Int
  viewed_at DateTime? @default(now()) @db.Timestamp(6)
  popup     popups    @relation(fields: [popup_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([popup_id, user_id])
  @@index([popup_id], map: "idx_popup_views_popup")
  @@index([user_id], map: "idx_popup_views_user")
  @@map("popup_views")
}

model disconnection_types {
  id                Int                 @id @default(autoincrement())
  company_id        Int
  name              String              @db.VarChar(100)
  description       String?             @db.VarChar(300)
  active            Boolean?            @default(true)
  created_at        DateTime?           @default(now()) @db.Timestamp(6)
  attendance        attendance[]
  attendance_breaks attendance_breaks[]
  companies         companies           @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([company_id], map: "idx_disconnection_types_company")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model password_access_log {
  id             Int            @id @default(autoincrement())
  vault_id       Int
  accessed_by    Int
  action         String         @db.VarChar(20)
  ip_address     String?        @db.VarChar(45)
  accessed_at    DateTime?      @default(now()) @db.Timestamp(6)
  users          users          @relation(fields: [accessed_by], references: [id], onDelete: SetNull, onUpdate: NoAction)
  password_vault password_vault @relation(fields: [vault_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([accessed_by], map: "idx_password_access_log_admin")
  @@index([accessed_at], map: "idx_password_access_log_date")
  @@index([vault_id], map: "idx_password_access_log_vault")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model password_vault {
  id                                     Int                   @id @default(autoincrement())
  user_id                                Int                   @unique
  encrypted_password                     String
  created_by                             Int?
  created_at                             DateTime?             @default(now()) @db.Timestamp(6)
  updated_at                             DateTime?             @default(now()) @db.Timestamp(6)
  password_access_log                    password_access_log[]
  users_password_vault_created_byTousers users?                @relation("password_vault_created_byTousers", fields: [created_by], references: [id], onUpdate: NoAction)
  users_password_vault_user_idTousers    users                 @relation("password_vault_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_password_vault_user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model vault_sessions {
  id          Int       @id @default(autoincrement())
  admin_id    Int
  unlocked_at DateTime? @default(now()) @db.Timestamp(6)
  expires_at  DateTime  @db.Timestamp(6)
  is_active   Boolean?  @default(true)
  locked_at   DateTime? @db.Timestamp(6)
  users       users     @relation(fields: [admin_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([is_active, expires_at], map: "idx_vault_sessions_active")
  @@index([admin_id], map: "idx_vault_sessions_admin")
}
