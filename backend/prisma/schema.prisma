generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model companies {
  id              Int       @id @default(autoincrement())
  name            String    @db.VarChar(200)
  domain          String    @unique @db.VarChar(150)
  primary_color   String    @default("#3b82f6") @db.VarChar(7)
  secondary_color String    @default("#e2e2e2") @db.VarChar(7)
  logo_url        String?   @db.VarChar(500)
  active          Boolean   @default(true)
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt

  branches            branches[]
  schedules           schedules[]
  disconnection_types disconnection_types[]
  roles               roles[]
  users               users[]
}

model branches {
  id         Int      @id @default(autoincrement())
  company_id Int
  name       String   @db.VarChar(100)
  address    String?  @db.VarChar(300)
  active     Boolean  @default(true)
  created_at DateTime @default(now())

  company companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
  users   users[]

  @@index([company_id])
}

model schedules {
  id           Int      @id @default(autoincrement())
  company_id   Int
  name         String   @db.VarChar(100)
  start_time   DateTime @db.Time
  end_time     DateTime @db.Time
  week_days    Json     @default("[\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\"]")
  is_24_hours  Boolean  @default(false)
  active       Boolean  @default(true)
  created_at   DateTime @default(now())

  company        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade)
  role_schedules role_schedules[]
  users          users[]

  @@index([company_id])
}

model disconnection_types {
  id          Int      @id @default(autoincrement())
  company_id  Int
  name        String   @db.VarChar(100)
  description String?  @db.VarChar(300)
  active      Boolean  @default(true)
  created_at  DateTime @default(now())

  company companies @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
}

model roles {
  id          Int      @id @default(autoincrement())
  company_id  Int
  name        String   @db.VarChar(100)
  description String?  @db.VarChar(300)
  permissions Json     @default("{}")
  active      Boolean  @default(true)
  created_at  DateTime @default(now())

  company        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade)
  role_schedules role_schedules[]
  users          users[]

  @@unique([company_id, name])
  @@index([company_id])
}

model role_schedules {
  id          Int      @id @default(autoincrement())
  role_id     Int
  schedule_id Int
  created_at  DateTime @default(now())

  role     roles     @relation(fields: [role_id], references: [id], onDelete: Cascade)
  schedule schedules @relation(fields: [schedule_id], references: [id], onDelete: Cascade)

  @@unique([role_id, schedule_id])
  @@index([role_id])
  @@index([schedule_id])
}

model users {
  id          Int       @id @default(autoincrement())
  company_id  Int
  name        String    @db.VarChar(150)
  email       String    @db.VarChar(200)
  password    String    @db.VarChar(255)
  role_id     Int?
  branch_id   Int?
  schedule_id Int?
  photo_url   String?   @db.VarChar(500)
  phone       String?   @db.VarChar(20)
  status      String    @default("active") @db.VarChar(20)
  last_access DateTime?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @default(now()) @updatedAt

  company  companies  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  role     roles?     @relation(fields: [role_id], references: [id], onDelete: SetNull)
  branch   branches?  @relation(fields: [branch_id], references: [id], onDelete: SetNull)
  schedule schedules? @relation(fields: [schedule_id], references: [id], onDelete: SetNull)

  @@unique([company_id, email])
  @@index([company_id])
  @@index([company_id, email])
  @@index([role_id])
  @@index([branch_id])
  @@index([status])
}